<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כל הדילים - נופש לי ולך</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1><a href="index.html">✈️ נופש לי ולך</a></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">דף הבית</a></li>
                    <li class="current"><a href="deals.html">כל הדילים</a></li>
                    <li><a href="admin.html">ניהול</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="all-deals-page" class="container">
        <h2>כל הדילים שלנו</h2>
        <p>כאן תוכלו למצוא את כל הדילים המעודכנים לטיסות, מלונות וחבילות נופש. בחרו את היעד הבא שלכם!</p>

        <div id="deals-list">
            <p>טוען דילים...</p>
        </div>
    </section>

    <footer>
        <p>נופש לי ולך &copy; <span id="currentYear"></span></p>
    </footer>

    <script type="module">
        import { db } from './firebase-init.js';
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        document.getElementById('currentYear').textContent = new Date().getFullYear();
        const dealsListContainer = document.getElementById('deals-list');

        async function fetchAllDeals() {
            if (!dealsListContainer) return;
            dealsListContainer.innerHTML = '<p>טוען דילים...</p>'; // הודעת טעינה

            try {
                const dealsRef = collection(db, 'deals');
                const q = query(dealsRef, orderBy('createdAt', 'desc')); // מציג דילים לפי תאריך הוספה (החדש ראשון)
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    dealsListContainer.innerHTML = '<p>לא נמצאו דילים זמינים כרגע. נסו שוב מאוחר יותר!</p>';
                    return;
                }

                let dealsHTML = '';
                querySnapshot.forEach((doc) => {
                    const deal = doc.data();
                    const dealId = doc.id;
                    dealsHTML += `
                        <div class="deal-item">
                            <img src="${deal.imageUrl || 'https://via.placeholder.com/300x200?text=תמונה+חסרה'}" alt="${deal.name}">
                            <div class="deal-item-content">
                                <h3>${deal.name}</h3>
                                <p class="price">${deal.price_text}</p>
                                <p>${deal.description.substring(0, 120)}...</p>
                                <a href="deal-details.html?dealId=${dealId}" class="button">פרטים והזמנה</a>
                            </div>
                        </div>
                    `;
                });
                dealsListContainer.innerHTML = dealsHTML;

            } catch (error) {
                console.error("Error fetching all deals: ", error);
                dealsListContainer.innerHTML = '<p>שגיאה בטעינת הדילים. אנא נסה לרענן את הדף.</p>';
            }
        }

        fetchAllDeals();
    </script>
</body>
</html>
