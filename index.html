<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="נופש לי ולך - דילים מיוחדים לטיסות, מלונות וחבילות נופש. הזמינו לבד או פנו אלינו לשירות אישי.">
    <title>נופש לי ולך - דף הבית</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1><a href="index.html">✈️ נופש לי ולך</a></h1>
            </div>
            <nav>
                <ul>
                    <li class="current"><a href="index.html">דף הבית</a></li>
                    <li><a href="deals.html">כל הדילים</a></li>
                    <li><a href="admin.html">ניהול</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="showcase">
        <div class="container">
            <h1>מצא את החופשה המושלמת שלך</h1>
            <p>דילים בלעדיים לטיסות, מלונות וחבילות. הזמן ישירות או קבל שירות אישי מאיתנו!</p>
            <a href="deals.html" class="button">צפה בכל הדילים</a>
        </div>
    </section>

    <section id="featured-deals" class="container">
        <h2>דילים מומלצים 🔥</h2>
        <div id="featured-deals-list" class="deals-grid">
            <p>טוען דילים מומלצים...</p>
        </div>
    </section>

    <footer>
        <p>נופש לי ולך &copy; <span id="currentYear"></span></p>
    </footer>

    <script type="module">
        import { db } from './firebase-init.js';
        import { collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        document.getElementById('currentYear').textContent = new Date().getFullYear();

        const featuredDealsListContainer = document.getElementById('featured-deals-list');

        async function fetchFeaturedDeals() {
            if (!featuredDealsListContainer) return;
            featuredDealsListContainer.innerHTML = '<p>טוען דילים מומלצים...</p>'; // הודעת טעינה

            try {
                const dealsRef = collection(db, 'deals');
                // כאן אפשר להוסיף לוגיקה לבחירת דילים "מומלצים", למשל לפי תאריך הוספה או שדה 'isFeatured'
                const q = query(dealsRef, orderBy('createdAt', 'desc'), limit(3)); // מציג 3 דילים אחרונים כמומלצים
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    featuredDealsListContainer.innerHTML = '<p>לא נמצאו דילים מומלצים כרגע.</p>';
                    return;
                }

                let dealsHTML = '';
                querySnapshot.forEach((doc) => {
                    const deal = doc.data();
                    const dealId = doc.id;
                    dealsHTML += `
                        <div class="deal-item">
                            <img src="${deal.imageUrl || 'https://via.placeholder.com/300x200?text=תמונה+חסרה'}" alt="${deal.name}">
                            <div class="deal-item-content">
                                <h3>${deal.name}</h3>
                                <p class="price">${deal.price_text}</p>
                                <p>${deal.description.substring(0, 100)}...</p>
                                <a href="deal-details.html?dealId=${dealId}" class="button">פרטים נוספים</a>
                            </div>
                        </div>
                    `;
                });
                featuredDealsListContainer.innerHTML = dealsHTML;
                // שינוי פריסה ל-grid אחרי טעינת הדילים
                featuredDealsListContainer.id = 'deals-list'; // שימוש באותו ID כמו בדף הדילים לטובת עיצוב עקבי

            } catch (error) {
                console.error("Error fetching featured deals: ", error);
                featuredDealsListContainer.innerHTML = '<p>שגיאה בטעינת הדילים המומלצים.</p>';
            }
        }

        fetchFeaturedDeals();
    </script>
</body>
</html>
